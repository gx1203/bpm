/*------------------------------------------------------*/
/*                   修改控件的配置信息                                                                    */
/*                   version:1.7.2                      */
/*                   number:001                         */
/*------------------------------------------------------*/
//64位控件的calssid
var classidx64 = "01DFB4B4-0E07-4e3f-8B7A-98FD6BFF153F";
//32位控件的classid
var classid = "01DFB4B4-0E07-4e3f-8B7A-98FD6BFF153F";
//32位控件包的路径
var codebase = "officecontrol/ofctnewclsid.cab#version=5,0,2,6";
//64位控件包的路径
var codebase64 = "officecontrol/ofctnewclsid.cab#version=5,0,2,6";
//设置高度
var height = "100%";
//设置宽度
var width = "100%";
//买断授权密钥如果不是买断可以不用写
var MakerCaption = "北京美络克思科技有限公司";
var Caption="欢迎使用WebOffice综合办公系统!";
//买断授权密钥如果不是买断可以不用写
var MakerKey = "C3F5BF43B534CDC8150F57D0647A14DB2F126CAC";
//密钥
var ProductCaption = "  ";
//密钥
var ProductKey = "1AF42BDDF946400F77E7CD28356B9102E96EECAB";
//解除时间密钥
var NoExpireKey="";

/*------------------------------------------------------*/
/*             以下内容 请勿修改，否则可能出错                                                              */
/*------------------------------------------------------*/

var userAgent = navigator.userAgent,
rMsie = /(msie\s|trident.*rv:)([\w.]+)/,
rFirefox = /(firefox)\/([\w.]+)/,
rOpera = /(opera).+version\/([\w.]+)/,
rChrome = /(chrome)\/([\w.]+)/,
rSafari = /version\/([\w.]+).*(safari)/;
var browser;
var version;
var ua = userAgent.toLowerCase();
function uaMatch(ua) {
	var match = rMsie.exec(ua);
	if (match != null) {
		return {
			browser: "IE",
			version: match[2] || "0"
		};
	}
	var match = rFirefox.exec(ua);
	if (match != null) {
		return {
			browser: match[1] || "",
			version: match[2] || "0"
		};
	}
	var match = rOpera.exec(ua);
	if (match != null) {
		return {
			browser: match[1] || "",
			version: match[2] || "0"
		};
	}
	var match = rChrome.exec(ua);
	if (match != null) {
		return {
			browser: match[1] || "",
			version: match[2] || "0"
		};
	}
	var match = rSafari.exec(ua);
	if (match != null) {
		return {
			browser: match[2] || "",
			version: match[1] || "0"
		};
	}
	if (match != null) {
		return {
			browser: "",
			version: "0"
		};
	}
}
var browserMatch = uaMatch(userAgent.toLowerCase());
if (browserMatch.browser) {
	browser = browserMatch.browser;
	version = browserMatch.version;
}

/*
谷歌浏览器事件接管
 */
function ntkosavetourl(type, code, html) {
	//alert("SaveToURL成功回调");
}

function ntkopublishashtml(type, code, html) {
	//alert("Onpublishashtmltourl成功回调");
}
function ntkopublishaspdf(type, code, html) {
	//alert("Onpublishaspdftourl成功回调");
}
function ntkosaveasotherurl(type, code, html) {
	//alert("SaveAsOtherformattourl成功回调");
}

function ntkoondocumentopened(type, code) {
	// alert("Ondocumentopened成功回调");
	fileName = type
	// alert(tyfileNamepe);

}
if (browser == "IE") {
	if (window.navigator.platform == "Win32") {
		document.write('<!-- 用来产生编辑状态的ActiveX控件的JS脚本-->   ');
		document.write('<!-- 因为微软的ActiveX新机制，需要一个外部引入的js-->   ');
		document.write('<object id="TANGER_OCX" classid="clsid:' + classid + '"');
		document.write('codebase="' + codebase + '" width="' + width + '" height="' + height + '">   ');
		document.write('<param name="MakerCaption" value="' + MakerCaption + '">   ');
		document.write('<param name="MakerKey" value="' + MakerKey + '">   ');
		document.write('<param name="ProductCaption" value="' + ProductCaption + '">   ');
		document.write('<param name="ProductKey" value="' + ProductKey + '">   ');
		document.write('<param name="NoExpireKey" value="'+NoExpireKey+'">   ');		
		document.write('<param name="IsUseUTF8URL" value="-1">   ');
		document.write('<param name="IsUseUTF8Data" value="-1">   ');
		document.write('<param name="MaxUploadSize" value="104857600">   ');
		document.write('<param name="Caption" value="'+Caption+'">   ');
		document.write('<param name="TitleBar" value="false">   ');
		document.write('<SPAN STYLE="color:red">不能装载文档控件。请在检查浏览器的选项中检查浏览器的安全设置。</SPAN>   ');
		document.write('</object>');
	}
	if (window.navigator.platform == "Win64") {

		document.write('<!-- 用来产生编辑状态的ActiveX控件的JS脚本-->   ');
		document.write('<!-- 因为微软的ActiveX新机制，需要一个外部引入的js-->   ');
		document.write('<object id="TANGER_OCX" classid="clsid:' + classidx64 + '"');
		document.write('codebase="' + codebase64 + '" width="' + width + '" height="' + height + '">   ');
		document.write('<param name="MakerCaption" value="' + MakerCaption + '">   ');
		document.write('<param name="MakerKey" value="' + MakerKey + '">   ');
		document.write('<param name="ProductCaption" value="' + ProductCaption + '">   ');
		document.write('<param name="ProductKey" value="' + ProductKey + '">   ');
		document.write('<param name="NoExpireKey" value="'+NoExpireKey+'">   ');		
		document.write('<param name="IsUseUTF8URL" value="-1">   ');
		document.write('<param name="IsUseUTF8Data" value="-1">   ');
		document.write('<param name="MaxUploadSize" value="104857600">   ');
		document.write('<param name="Caption" value="'+Caption+'">   ');
		document.write('<param name="TitleBar" value="false">   ');
		document.write('<SPAN STYLE="color:red">不能装载文档控件。请在检查浏览器的选项中检查浏览器的安全设置。</SPAN>   ');
		document.write('</object>');
	}
} else if (browser == "firefox") {
	document.write('<object id="TANGER_OCX" type="application/ntko-plug"  codebase="' + codebase + '" width="' + width + '" height="' + height + '" ForOnSaveToURL="ntkosavetourl"  ForOndocumentopened="ntkoondocumentopened"');
	document.write('ForOnpublishAshtmltourl="ntkopublishashtml"');
	document.write('ForOnpublishAspdftourl="ntkopublishaspdf"');
	document.write('ForOnSaveAsOtherFormatToUrl="ntkosaveasotherurl"');
	document.write('_MakerCaption="' + MakerCaption + '"  ');
	document.write('_MakerKey="' + MakerKey + '"  ');
	document.write('_ProductCaption="' + ProductCaption + '"  ');
	document.write('_ProductKey="' + ProductKey + '"   ');
	document.write('_NoExpireKey="'+NoExpireKey+'"   ');
	document.write('clsid="{' + classid + '}" >');
	document.write('<SPAN STYLE="color:red">尚未安装NTKO Web FireFox跨浏览器插件</SPAN>   ');
	document.write('</object>   ');
} else if (browser == "chrome") {
	document.write('<object id="TANGER_OCX" clsid="{' + classid + '}"  ForOnSaveToURL="ntkosavetourl"  ForOndocumentopened="ntkoondocumentopened"');
	document.write('ForOnpublishAshtmltourl="ntkopublishashtml"');
	document.write('ForOnpublishAspdftourl="ntkopublishaspdf"');
	document.write('ForOnSaveAsOtherFormatToUrl="ntkosaveasotherurl"');
	document.write('_IsUseUTF8URL="-1"   ');
	document.write('_IsUseUTF8Data="-1"   ');
	document.write('_MakerCaption="' + MakerCaption + '"  ');
	document.write('_MakerKey="' + MakerKey + '"  ');
	document.write('_ProductCaption="' + ProductCaption + '"  ');
	document.write('_ProductKey="' + ProductKey + '"   ');
	document.write('_NoExpireKey="'+NoExpireKey+'"   ');
	document.write('codebase="' + codebase + '" width="' + width + '" height="' + height + '" type="application/ntko-plug" ');
	document.write('<SPAN STYLE="color:red">尚未安装NTKO Web Chrome跨浏览器插件</SPAN>   ');
	document.write('</object>');
} else if (Sys.opera) {
	alert("sorry,ntko web印章暂时不支持opera!");
} else if (Sys.safari) {
	alert("sorry,ntko web印章暂时不支持safari!");
}
//触发跨浏览插件的方法
//ie关闭方法

window.onunload =function(){
	var ntkojb= ntkoBrowser.NtkoJudgingBrowsers();
	if(ntkojb){
		window.opener.ntkoCloseEvent();	
	}
	
	
}
window.onbeforeunload=function(){
	if(cmd==4){
	ntkoSendDataToParentPage();
	}
}

//ie,谷歌，火狐传值
var ntkoBrowser={
		ntkoSetReturnValueToParentPage:function(data1,text1){
			
		   var ntkojb= ntkoBrowser.NtkoJudgingBrowsers();
	       if(ntkojb){
		   window.opener.ieattachEventntko(data1,text1);
	       }else{
		   window.external.SetReturnValueToParentPage(data1,text1);
	       }						
	},
    NtkoBrower:function(){		
		if(browser=="IE"){			
           return false;
		}
		if(browser=="firefox"){
			 if(userAgent.indexOf("Windows NT 5.1") > -1){
				 return false;
			 }				
			if(version>="50"){						
			 return true;		
			}else{				
			return false;
			}						 			  
		 }
		 if(browser=="chrome"){
			 if(userAgent.indexOf("Windows NT 5.1") > -1){
				 return false;
			 }			
			 if(version>="45"){				    																
				 return true;
			 }else{
				return false;
			 }			  
		}	
    },
	NtkoJudgingBrowsers:function(){
		try{
			var ntkobtop=window.opener.top.browser;
			return true;
			}catch(err){
			return false;
			}
	}

}